     1                                 %line 1+1 test_lib.asm
     2                                 
     3                                 
     4                                 [extern exit]
     5                                 [extern strlen]
     6                                 [extern print_string]
     7                                 [extern print_char]
     8                                 [extern print_newline]
     9                                 
    10                                 [section .data]
    11                                 test_string:
    12 00000000 30313233343500          db "012345", 0
    13                                 
    14                                 strlen_failed_msg:
    15 00000007 7374726C656E206861-     db "strlen had incorrect return value!", 0xA, 0
    16 00000007 6420696E636F727265-
    17 00000007 63742072657475726E-
    18 00000007 2076616C7565210A00 
    19                                 
    20                                 [section .text]
    21                                 
    22                                 [global _start]
    23                                 _start:
    24                                 
    25 00000000 48C7C7[00000000]        mov rdi, test_string
    26 00000007 E8(F6FFFFFF)            call strlen
    27 0000000C 4883F806                cmp rax, 6
    28 00000010 753D                    jne .strlen_failed
    29                                 
    30                                 
    31 00000012 48C7C7[00000000]        mov rdi, test_string
    32 00000019 E8(F6FFFFFF)            call print_string
    33                                 
    34                                 
    35 0000001E E8(F6FFFFFF)            call print_newline
    36 00000023 48C7C75F000000          mov rdi, '_'
    37 0000002A E8(F6FFFFFF)            call print_char
    38 0000002F E8(F6FFFFFF)            call print_newline
    39 00000034 48C7C77C000000          mov rdi, '|'
    40 0000003B E8(F6FFFFFF)            call print_char
    41 00000040 E8(F6FFFFFF)            call print_newline
    42                                 
    43                                 
    44 00000045 48C7C000000000          mov rax, 0
    45 0000004C E8(F6FFFFFF)            call exit
    46                                 
    47                                 .strlen_failed:
    48                                 
    49 00000051 48C7C7[00000000]        mov rdi, strlen_failed_msg
    50 00000058 E8(F6FFFFFF)            call print_string
    51                                 
    52 0000005D 48C7C001000000          mov rax, 1
    53 00000064 E8(F6FFFFFF)            call exit
